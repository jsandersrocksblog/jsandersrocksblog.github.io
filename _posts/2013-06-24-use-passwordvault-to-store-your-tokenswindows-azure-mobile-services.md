---
id: 223
title: 'Use PasswordVault to Store Your Tokens&#8211;Windows Azure Mobile Services'
date: 2013-06-24T09:04:59-05:00
author: jsanders
layout: post
guid: http://jsandersblog.azurewebsites.net/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/
permalink: /2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/
orig_url:
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokens-windows-azure-mobile-services.aspx
orig_site_id:
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
orig_post_id:
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
orig_parent_id:
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
  - "10428195"
orig_thread_id:
  - "846782"
  - "846782"
  - "846782"
  - "846782"
  - "846782"
  - "846782"
  - "846782"
  - "846782"
  - "846782"
orig_application_key:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_id:
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
orig_post_author_username:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_created:
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
  - 2007-01-18 13:34:53.000
orig_is_approved:
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
orig_attachment_count:
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
orig_url_title:
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services.aspx
orig_post_name:
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
  - use passwordvault to store your tokens windows azure mobile services
orig_post_author_email:
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
  - jsanders@microsoft.com
total_views:
  - "2567"
  - "2567"
  - "2567"
  - "2567"
  - "2567"
  - "2567"
  - "2567"
  - "2567"
  - "2567"
opengraph_tags:
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta property="og:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Use PasswordVault to Store Your Tokens&ndash;Windows Azure Mobile Services" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2013/06/24/use-passwordvault-to-store-your-tokenswindows-azure-mobile-services/" />
    <meta name="twitter:description" content="There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app. Copy Code: using Microsoft.WindowsAzure.MobileServices; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using Windows.Security.Credentials; namespace MobileServices.Samples.Authentication..." />
    <meta name="twitter:image" content="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" />
    
categories:
  - Uncategorized
tags:
  - Windows Azure Mobile Services
  - Windows Store applications
---
There was no end to end sample of how you might use the PasswordVault to store your JWT used for user authentication in Mobile Services.&#160; I created this class to be used with your Windows Store app.

**<a style="background: lightgray;" href="javascript:CopyCode('CopyCodeCodeToken1');">Copy Code:</a>** 

<pre id="CopyCodeCodeToken1" class="code"><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">Microsoft.WindowsAzure.MobileServices;
</span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System;
</span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Collections.Generic;
</span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Linq;
</span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Text;
</span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Threading.Tasks;
</span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">Windows.Security.Credentials;
</span><span style="background: white; color: blue;">namespace </span><span style="background: white; color: black;">MobileServices.Samples.Authentication
{
    </span><span style="background: white; color: blue;">class </span><span style="background: white; color: rgb(43, 145, 175);">AuthProviderVault
    </span><span style="background: white; color: black;">{
        </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceClient </span><span style="background: white; color: black;">_mobileService = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
        </span><span style="background: white; color: blue;">private </span><span style="background: white; color: rgb(43, 145, 175);">PasswordVault </span><span style="background: white; color: black;">providerVault = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
        </span><span style="background: white; color: blue;">public </span><span style="background: white; color: black;">AuthProviderVault(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceClient </span><span style="background: white; color: black;">mobileService)
        {
            </span><span style="background: white; color: green;">// PasswordVault is specific to this Windows Store app
            </span><span style="background: white; color: black;">providerVault = </span><span style="background: white; color: blue;">new </span><span style="background: white; color: rgb(43, 145, 175);">PasswordVault</span><span style="background: white; color: black;">();
            </span><span style="background: white; color: green;">// Set to the application MobileService
            </span><span style="background: white; color: black;">_mobileService = mobileService;
        }
        </span><span style="background: white; color: green;">// Use the MobileService login
        </span><span style="background: white; color: blue;">public async </span><span style="background: white; color: rgb(43, 145, 175);">Task</span><span style="background: white; color: black;">&lt;</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser</span><span style="background: white; color: black;">&gt; LoginUser(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider </span><span style="background: white; color: black;">provider)
        {
            </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">user = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
            </span><span style="background: white; color: green;">//There should be a MobileService attached!
            </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(_mobileService != </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">)
            {
                </span><span style="background: white; color: blue;">try
                </span><span style="background: white; color: black;">{
                    </span><span style="background: white; color: green;">// Clear the CurrentUser
                    </span><span style="background: white; color: black;">_mobileService.CurrentUser = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
                    </span><span style="background: white; color: green;">// Use the OAuth Login for the provider
                    </span><span style="background: white; color: black;">user = </span><span style="background: white; color: blue;">await </span><span style="background: white; color: black;">_mobileService.LoginAsync(provider);
                    </span><span style="background: white; color: green;">// Have user will add!
                    </span><span style="background: white; color: black;">addToVault(provider, user);
                    </span><span style="background: white; color: green;">//  Set the current user
                    </span><span style="background: white; color: black;">_mobileService.CurrentUser = user;
                }
                </span><span style="background: white; color: blue;">catch </span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">InvalidOperationException </span><span style="background: white; color: black;">exLogin)
                {
                    </span><span style="background: white; color: blue;">string </span><span style="background: white; color: black;">error = </span><span style="background: white; color: rgb(163, 21, 21);">"An error occurred during login. Login Required. Message: " </span><span style="background: white; color: black;">+ exLogin.Message;
                    user = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
                }
            }
            </span><span style="background: white; color: green;">// might be null
            </span><span style="background: white; color: blue;">return </span><span style="background: white; color: black;">user;
        }
        </span><span style="background: white; color: green;">// Will use the user JWT stored in the vault or go to LoginUser
        </span><span style="background: white; color: blue;">public async </span><span style="background: white; color: rgb(43, 145, 175);">Task</span><span style="background: white; color: black;">&lt;</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser</span><span style="background: white; color: black;">&gt; GetOrLoginMobileServiceUser(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider </span><span style="background: white; color: black;">provider)
        {
            </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">userReturned = getStoredMobileServiceUser(provider);
            </span><span style="background: white; color: green;">// See if there is a user stored in the vault use it otherwise<br />            // call LoginUser (which will also store the user in the vault)
            </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(userReturned == </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">)
            {
                userReturned = </span><span style="background: white; color: blue;">await </span><span style="background: white; color: black;">LoginUser(provider);
            }
            </span><span style="background: white; color: green;">//userReturned could still be null if the user does not login
            </span><span style="background: white; color: black;">_mobileService.CurrentUser = userReturned;
            </span><span style="background: white; color: blue;">return </span><span style="background: white; color: black;">userReturned;
        }
        </span><span style="background: white; color: green;">// adds a provider based User to the vault or replaces and existing one
        </span><span style="background: white; color: blue;">private void </span><span style="background: white; color: black;">addToVault(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider </span><span style="background: white; color: black;">provider, </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">user)
        {
            </span><span style="background: white; color: rgb(43, 145, 175);">IReadOnlyList</span><span style="background: white; color: black;">&lt;</span><span style="background: white; color: rgb(43, 145, 175);">PasswordCredential</span><span style="background: white; color: black;">&gt; creds = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
            </span><span style="background: white; color: blue;">try
            </span><span style="background: white; color: black;">{
                </span><span style="background: white; color: green;">// Will throw an exception if none found (I hate that design)
                </span><span style="background: white; color: black;">creds = providerVault.FindAllByResource(vaultKey(provider));
            }
            </span><span style="background: white; color: blue;">catch </span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">Exception</span><span style="background: white; color: black;">)
            {
                </span><span style="background: white; color: green;">//expect an exception if not found in container
            </span><span style="background: white; color: black;">}
            </span><span style="background: white; color: green;">// remove existing creds (there should be only one if this is the only access to the App PasswordVault
            </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(creds != </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">)
            {
                </span><span style="background: white; color: blue;">foreach </span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">PasswordCredential </span><span style="background: white; color: black;">cred </span><span style="background: white; color: blue;">in </span><span style="background: white; color: black;">creds)
                {
                    providerVault.Remove(cred);
                }
            }
            </span><span style="background: white; color: green;">// Create a new cred and add it to the vault
            </span><span style="background: white; color: rgb(43, 145, 175);">PasswordCredential </span><span style="background: white; color: black;">newCred = <br /></span><span style="background: white; color: blue;">new </span><span style="background: white; color: rgb(43, 145, 175);">PasswordCredential</span><span style="background: white; color: black;">(vaultKey(provider), user.UserId, user.MobileServiceAuthenticationToken);
            providerVault.Add(newCred);
        }
        </span><span style="background: white; color: blue;">private string </span><span style="background: white; color: black;">vaultKey(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider </span><span style="background: white; color: black;">provider)
        {
            </span><span style="background: white; color: blue;">return </span><span style="background: white; color: black;">provider + </span><span style="background: white; color: rgb(163, 21, 21);">":" </span><span style="background: white; color: black;">+ _mobileService.ApplicationUri.DnsSafeHost;
        }
        </span><span style="background: white; color: blue;">private </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">getStoredMobileServiceUser(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider </span><span style="background: white; color: black;">provider)
        {
            </span><span style="background: white; color: green;">// if found in the vault return the mobile service user with info
            </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">userReturned = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
            </span><span style="background: white; color: blue;">try
            </span><span style="background: white; color: black;">{
                </span><span style="background: white; color: rgb(43, 145, 175);">PasswordCredential </span><span style="background: white; color: black;">userCred = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
                </span><span style="background: white; color: rgb(43, 145, 175);">IReadOnlyList</span><span style="background: white; color: black;">&lt;</span><span style="background: white; color: rgb(43, 145, 175);">PasswordCredential</span><span style="background: white; color: black;">&gt; creds = providerVault.FindAllByResource(vaultKey(provider));
                </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(creds != </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">)
                {
                    </span><span style="background: white; color: green;">// In my code there should ONLY be one cred per provider so problably should check that.
                    </span><span style="background: white; color: black;">userCred = creds[0];
                    </span><span style="background: white; color: green;">// Create a User to use with the Mobile Service (instead of doing the login sequence)
                    </span><span style="background: white; color: black;">userReturned = </span><span style="background: white; color: blue;">new </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser</span><span style="background: white; color: black;">(userCred.UserName);
                    </span><span style="background: white; color: green;">// Explicitly fetch the PWD into memory
                    </span><span style="background: white; color: black;">userCred.RetrievePassword();
                    </span><span style="background: white; color: green;">// Set the JWT
                    </span><span style="background: white; color: black;">userReturned.MobileServiceAuthenticationToken = userCred.Password;
                    </span><span style="background: white; color: green;">// remove from memory
                    </span><span style="background: white; color: black;">userCred = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
                }
            }
            </span><span style="background: white; color: blue;">catch </span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">Exception </span><span style="background: white; color: black;">e)
            {
                </span><span style="background: white; color: green;">// if there was an exeption, eat the error
                </span><span style="background: white; color: black;">userReturned = </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">;
            }
            </span><span style="background: white; color: blue;">return </span><span style="background: white; color: black;">userReturned;
        }
    }
}
</span></pre>

&#160;

This is pretty easy to used.&#160; I modified our Auth Sample to use this with each of the providers.&#160; Here is an example from Scenario1.xaml.cx:

**<a style="background: lightgray;" href="javascript:CopyCode('CopyCodeCodeToken2');">Copy Code:</a>** 

<pre id="CopyCodeCodeToken2" class="code"><span style="background: white; color: black;"> </span><span style="background: white; color: blue;">private async void </span><span style="background: white; color: black;">Launch_Click(</span><span style="background: white; color: blue;">object </span><span style="background: white; color: black;">sender, </span><span style="background: white; color: rgb(43, 145, 175);">RoutedEventArgs </span><span style="background: white; color: black;">e)
        {
            </span><span style="background: white; color: blue;">try
            </span><span style="background: white; color: black;">{
                </span><span style="background: white; color: rgb(43, 145, 175);">AuthProviderVault </span><span style="background: white; color: black;">vlt = </span><span style="background: white; color: blue;">new </span><span style="background: white; color: rgb(43, 145, 175);">AuthProviderVault</span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">App</span><span style="background: white; color: black;">.MobileService);
                </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">user = <br /></span><span style="background: white; color: blue;">await </span><span style="background: white; color: black;">vlt.GetOrLoginMobileServiceUser(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider</span><span style="background: white; color: black;">.Facebook);
                </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(user != </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">)
                {
                    </span><span style="background: white; color: blue;">this</span><span style="background: white; color: black;">.OutputPrint(</span><span style="background: white; color: blue;">string</span><span style="background: white; color: black;">.Format(</span><span style="background: white; color: rgb(163, 21, 21);">"You are now logged in - {0}"</span><span style="background: white; color: black;">, user.UserId));
                    </span><span style="background: white; color: rgb(43, 145, 175);">App</span><span style="background: white; color: black;">.MobileService.CurrentUser = user;
                }
                </span><span style="background: white; color: blue;">else
                </span><span style="background: white; color: black;">{
                    </span><span style="background: white; color: blue;">this</span><span style="background: white; color: black;">.DebugPrint(</span><span style="background: white; color: rgb(163, 21, 21);">"An error occurred during login. Login Required."</span><span style="background: white; color: black;">);
                }
            }
            </span><span style="background: white; color: blue;">catch </span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">InvalidOperationException</span><span style="background: white; color: black;">)
            {
                </span><span style="background: white; color: blue;">this</span><span style="background: white; color: black;">.DebugPrint(</span><span style="background: white; color: rgb(163, 21, 21);">"An error occurred during login. Login Required."</span><span style="background: white; color: black;">);
            }
        }</span></pre>

When you attempt to use a table you could fail with an Unauthorized exception.&#160; If this does happen simply clear the old credential for the provider you are using and call LoginUser to get and store new credentials in the vault.

&#160;

**<a style="background: lightgray;" href="javascript:CopyCode('CopyCodeCodeToken3');">Copy Code:</a>** 

<pre id="CopyCodeCodeToken3" class="code"><span style="background: white; color: black;">            </span><span style="background: white; color: blue;">try
            </span><span style="background: white; color: black;">{
                items = </span><span style="background: white; color: blue;">await </span><span style="background: white; color: black;">todoTable.ToCollectionAsync();
            }
            </span><span style="background: white; color: blue;">catch </span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceInvalidOperationException </span><span style="background: white; color: black;">msEx)
            {
                </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(msEx.Response.StatusCode == System.Net.</span><span style="background: white; color: rgb(43, 145, 175);">HttpStatusCode</span><span style="background: white; color: black;">.Unauthorized)
                {
                    </span><span style="background: white; color: rgb(43, 145, 175);">AuthProviderVault </span><span style="background: white; color: black;">vlt = </span><span style="background: white; color: blue;">new </span><span style="background: white; color: rgb(43, 145, 175);">AuthProviderVault</span><span style="background: white; color: black;">(</span><span style="background: white; color: rgb(43, 145, 175);">App</span><span style="background: white; color: black;">.MobileService);
                    </span><span style="background: white; color: green;">// LoginUser goes right to the OAuth Login and then stores the user info in the vault
                    </span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceUser </span><span style="background: white; color: black;">user = </span><span style="background: white; color: blue;">await </span><span style="background: white; color: black;">vlt.LoginUser(</span><span style="background: white; color: rgb(43, 145, 175);">MobileServiceAuthenticationProvider</span><span style="background: white; color: black;">.Facebook);
                    </span><span style="background: white; color: blue;">if </span><span style="background: white; color: black;">(user != </span><span style="background: white; color: blue;">null</span><span style="background: white; color: black;">)
                    {
                        </span><span style="background: white; color: green;">// user has been set on the MobileService so retry the query up to x times here!
                    </span><span style="background: white; color: black;">}
                    </span><span style="background: white; color: blue;">else
                    </span><span style="background: white; color: black;">{
                        </span><span style="background: white; color: green;">// user could have denied to login and hit the back button
                    </span><span style="background: white; color: black;">}
                }
            }
</span></pre>

You can see the credentials (and remove them) in the credential manager after you have stored them:

<a href="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/5516.image_3290A012.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-94-metablogapi/5516.image_5F00_3290A012.png"><img loading="lazy" title="image" style="display: inline; background-image: none;" border="0" alt="image" src="/assets/images/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/83/94/metablogapi/7510.image_thumb_0673A321.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-83-94-metablogapi/7510.image_5F00_thumb_5F00_0673A321.png" width="582" height="312" /></a>

&#160;

This should get your ideas flowing and if this helps let me know!