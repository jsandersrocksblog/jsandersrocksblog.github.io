---
id: 593
title: Certificate Revocation List (CRL) Check and WinHttp Proxy settings
date: 2011-02-21T08:52:00-05:00
author: jsanders
layout: post
guid: http://jsandersblog.azurewebsites.net/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/
permalink: /2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/
orig_url:
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
orig_site_id:
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
orig_post_id:
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
orig_parent_id:
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
  - "10132267"
orig_thread_id:
  - "754518"
  - "754518"
  - "754518"
  - "754518"
  - "754518"
  - "754518"
  - "754518"
  - "754518"
  - "754518"
  - "754518"
orig_application_key:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_id:
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
orig_post_author_username:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_created:
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
orig_is_approved:
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
orig_attachment_count:
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
orig_url_title:
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings.aspx
opengraph_tags:
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Certificate Revocation List (CRL) Check and WinHttp Proxy settings" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2011/02/21/certificate-revocation-list-crl-check-and-winhttp-proxy-settings/" />
    <meta name="twitter:description" content="Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: http://support.microsoft.com/kb/887196).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks. To allow the CRL check out..." />
    
categories:
  - Uncategorized
---
Starting with Windows XP SP2, the Crypto API CRL check uses WinHttp (see: [http://support.microsoft.com/kb/887196](http://support.microsoft.com/kb/887196 "http://support.microsoft.com/kb/887196")).&nbsp; This can cause some confusion with network administrators and developers since they might have set proxy information for WinInet or applications using CryptoAPIs but the certificate validation fails for the https calls inside certain networks.

To allow the CRL check out to the cloud, the CLR code using WinHttp needs to be able to make it through your proxy!&nbsp; WinHttp can ONLY perform Automatic Proxy Detection using WPAD or use a static proxy.&nbsp; If you network supports WPAD (which is recommended) then you should not have a problem.&nbsp; If machines are using a static proxy, then you must set the same static proxy for WinHttp on that machine or the CRL check will fail.&nbsp; If you have a static pac file configured, then this will fail since WinHttp cannot use a static Pac file (use WPAD to provide the PAC file instead).

Another option is to allow direct connection through your proxy or firewall by configuring a rule to allow the User-Agent header that the CRL check uses to pass through.&nbsp; That header is currently: User-Agent: Microsoft-CryptoAPI/6.0 

If you refuse to use WPAD then you can set a static proxy for WinHttp settings that will in turn be used by the Crypto API CRL check.&nbsp; Depending on the version of the OS you are running you will use netsh or winhttpcfg.exe to set the static proxy.&nbsp; You cannot set this value programmatically inside of your program for just that particular instance or process however.&nbsp; The setting for the proxy in this case is a system wide setting and not per process. 

More information: 

How Certificate Revocation Works &#8211; [http://technet.microsoft.com/en-us/library/ee619754(WS.10).aspx](http://technet.microsoft.com/en-us/library/ee619754(WS.10).aspx "http://technet.microsoft.com/en-us/library/ee619754(WS.10).aspx") 

Summary of CryptoAPI changes: [http://support.microsoft.com/kb/887195](http://support.microsoft.com/kb/887195 "http://support.microsoft.com/kb/887195") and <http://support.microsoft.com/kb/887196> 

&nbsp; 

Please Drop me a note if you found this helpful!