There are some powerful tracing tools built into Windows 7 that can help you diagnose Internet Client issues.&nbsp; This walk though shows you now to enable tracing when accessing a web site using Internet Explorer 8 or other WinInet based applications.

Network tracing in Windows 7 (ref: <http://msdn.microsoft.com/en-us/library/dd569136(VS.85).aspx>)&nbsp; uses Event Tracing for Windows (ETW) (ref: <http://msdn.microsoft.com/en-us/library/bb968803(VS.85).aspx>) to enable you to see what is happening at the WinInet, Winsock, WebIO and TCP level.&nbsp; By looking at a simple example, you can see how this may be useful when analyzing http traffic.

1. Open an elevated command prompt by going to &lsquo;Start&rsquo;, &lsquo;All Programs&rsquo;, &lsquo;Accessories&rsquo;, Right click on &lsquo;Command Prompt&rsquo; and choose &lsquo;Run as administrator&rsquo;  
2. Type this into the command prompt: netsh trace start scenario = InternetClient level=5 tracefile=protocols.etl (Note:&nbsp; if you want netmon traffice too append **capture =&nbsp;yes** to the end of the command like this: netsh trace start scenario = InternetClient level=5 tracefile=protocols.etl&nbsp; capture=yes )  
3. Open <http://www.microsoft.com/protocols> in Internet Explorer  
4. After that page has rendered, stop tracing by typing into the command prompt window: netsh trace stop  
5. Download and install the latest network monitor from <http://www.microsoft.com/downloads/en/results.aspx?freetext=netmon&displaylang=en&stype=s_basic> (version at the time of this publication is &lsquo;Microsoft Network Monitor 3.3&rsquo;)  
6. Open the trace file in netmon from c:\windows\system32\protocols.etl  
7. Install the full parsers in netmon by going to &lsquo;Tools&rsquo;, &lsquo;Options&rsquo; then click on the &lsquo;Parser Profiles&rsquo; tab, click on the &lsquo;Microsoft Windows&rsquo; then choose &lsquo;Set As Active&rsquo; and then &lsquo;OK&rsquo; (see image below)

<a href="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_2.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_2.png"><img loading="lazy" style="display: inline; border: 0px;" title="image" src="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb.png" alt="image" width="621" height="348" border="0" /></a>

You should now be able to see WinInet, TCPIP and other traffic in the &lsquo;Network Conversations&rsquo; window.&nbsp; To find the conversations with &lsquo;protocols&rsquo; in the description, type this in the display filter: _description.contains(&#8220;protocols&#8221;)_ and hit the Apply icon.

<a href="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_4.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_4.png"><img loading="lazy" style="display: inline; border: 0px;" title="image" src="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_1.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_1.png" alt="image" width="619" height="198" border="0" /></a>

Here is where you can start to see the power of using netmon to analyze this data.&nbsp; You should see a description similar to: WinINet\_MicrosoftWindowsWinINet:WININET\_SENDREQUEST_START &#8211; Request : 0x078B3EF0, AddressName : <http://www.microsoft.com/protocols>

<a href="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_6.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_6.png"><img loading="lazy" style="display: inline; border: 0px;" title="image" src="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_2.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_2.png" alt="image" width="621" height="85" border="0" /></a>

If you right click on this and choose &lsquo;Find conversations&rsquo;, &lsquo;NetEvent&rsquo; you will see that the &lsquo;Network Conversations&rsquo; is now highlighting the conversation associated with that request.&nbsp;

<a href="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_10.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_10.png"><img loading="lazy" style="display: inline; border: 0px;" title="image" src="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_4.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_4.png" alt="image" width="625" height="159" border="0" /></a>

Remove the Display filter now so that you are not filtering by the description anymore.&nbsp; Once you do this you can see where there may be Cookie information, TCP information,&nbsp; WinInet connection information, TCP information, Http response information and other internal WinInet information.

&nbsp;<a href="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_12.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_12.png"><img loading="lazy" style="display: inline; border: 0px;" title="image" src="/assets/images/TNBlogsFS/BlogFileStorage/blogs_msdn/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_5.png" original-url="http://blogs.msdn.com/blogfiles/jpsanders/WindowsLiveWriter/UsingnetshtoanalyzeWinInetproblemsinWind_A564/image_thumb_5.png" alt="image" width="667" height="560" border="0" /></a>

Although there seems to be a mountain of information, you can use this to see what is different between a successful and failed case fairly quickly.&nbsp; The Description column is pretty good at describing what each of the frames are showing you.&nbsp; This will even let you see activity down to the WinSock level!

Try clicking on the other WinInet traffic links in the Network Conversations pane to see what other WinInet activity is occurring.&nbsp; You will see images being retrieved among other activity.&nbsp; This will give you&nbsp; very detailed look at what WinInet is doing during the time you took the trace.

Other tools are available to analyze the HTTP traffic.&nbsp; Fiddler (ref: <http://fiddlertool.com> ) is an excellent tool that can also allow you to see SSL content as well as performance metrics.&nbsp; You could also use Netmon directly to see network traffic.&nbsp; ETW tracing lets you see into what WinInet is doing however and will allow you a finer grained troubleshooting view along with the network traffic.&nbsp; You can use ETW tracing as another powerful tool in your arsenal to help with HTTP protocol troubleshooting.&nbsp; You can use ETW tracing to analyze HTTPS traffic as well.&nbsp; You cannot see all the content in clear text but you will notice the buffer in the WININET\_HTTP\_RESPONSE_HEADERS: HTTP Response Headers responses will show the beginnings of the data and show the headers in clear text.

Let me know if this post was useful to you!