---
id: 403
title: ATL Library and Windows Store apps
date: 2012-12-27T11:32:43-05:00
author: jsanders
layout: post
guid: http://jsandersblog.azurewebsites.net/2012/12/27/atl-library-and-windows-store-apps/
permalink: /2012/12/27/atl-library-and-windows-store-apps/
orig_url:
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
orig_site_id:
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
orig_post_id:
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
orig_parent_id:
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
  - "10381016"
orig_thread_id:
  - "830857"
  - "830857"
  - "830857"
  - "830857"
  - "830857"
  - "830857"
  - "830857"
  - "830857"
  - "830857"
orig_application_key:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_id:
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
orig_post_author_username:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_created:
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
orig_is_approved:
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
orig_attachment_count:
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
orig_url_title:
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2012/12/27/atl-library-and-windows-store-apps.aspx
opengraph_tags:
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ATL Library and Windows Store apps" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ATL Library and Windows Store apps" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2012/12/27/atl-library-and-windows-store-apps/" />
    <meta name="twitter:description" content="Just a quick post in case you run up against this issue. You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool. If you include CComCriticalSection in your Windows Store app code..." />
    
categories:
  - Uncategorized
---
Just a quick post in case you run up against this issue.

You can use a subset of ATL Library code in your Windows Store app.&#160; You may run into errors with validation when compiling or when running the Windows App Certification Kit (WACK) tool.

If you include CComCriticalSection in your Windows Store app code and then run the WACK tool you will get these errors:

<font face="Consolas">Error Found: The supported APIs test detected the following errors:</font>

  * <font face="Consolas">API GetModuleHandleW in kernel32.dll is not supported for this application type. XXXXX.XXX calls this API. </font>
  * <font face="Consolas">API InitializeCriticalSectionAndSpinCount in kernel32.dll is not supported for this application type. XXXXX.XXX calls this API.</font>

This is caused by a bug in the current ATL Library.&#160; The workaround is to add this code to your project which will implement the correct code (add it to any of your CPP files):

<font face="Consolas">#if (_ATL_NTDDI_MIN >= NTDDI_VISTA) </font>

<font face="Consolas">namespace ATL { </font>

<font face="Consolas">BOOL _AtlInitializeCriticalSectionEx(__out LPCRITICAL_SECTION lpCriticalSection, __in DWORD dwSpinCount, __in DWORD Flags) <br /> { <br />&#160;&#160;&#160;&#160; return InitializeCriticalSectionEx(lpCriticalSection, dwSpinCount, Flags);&#160; <br /> } </font>

<font face="Consolas">} <br />#endif </font>

<font face="Consolas"></font>

Let me know if this helped you out!

-Jeff