---
id: 1323
title: Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005
date: 2007-05-11T13:10:00-05:00
author: jsanders
layout: post
guid: http://jsandersblog.azurewebsites.net/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/
permalink: /2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/
orig_url:
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.microsoft.com/b/jpsanders/archive/2007/05/11/extra-characters-r-n-when-converting-mfc-isapi-under-vs-2005.aspx
orig_site_id:
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
  - "8394"
orig_post_id:
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
orig_parent_id:
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
  - "2550185"
orig_thread_id:
  - "512993"
  - "512993"
  - "512993"
  - "512993"
  - "512993"
  - "512993"
  - "512993"
  - "512993"
  - "512993"
  - "512993"
orig_application_key:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_id:
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
  - "65385"
orig_post_author_username:
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
  - jpsanders
orig_post_author_created:
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
  - Jan 18 2007 01:34:53:000PM
orig_is_approved:
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
  - "1"
orig_attachment_count:
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
  - "0"
orig_url_title:
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
  - http://blogs.msdn.com/b/jpsanders/archive/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005.aspx
opengraph_tags:
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta property="og:site_name" content="Http Client Protocol Issues (and other fun stuff I support)" />
    <meta property="og:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Extra Characters (/r/n) when Converting MFC ISAPI under VS 2005" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/jpsanders/2007/05/11/extra-characters-rn-when-converting-mfc-isapi-under-vs-2005/" />
    <meta name="twitter:description" content="When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if..." />
    
categories:
  - Uncategorized
tags:
  - ISAPI
---
When you convert an MFC ISAPI&nbsp;project you created in an early version of Visual Studio to MFC 8 (VS 2005) you may notice that there is an extra set of carriage return linefeed characters.&nbsp; This will be true if your code does not add a header to the return stream.&nbsp; You can see this if you take the default project and comment out the lines as shown below:<p class=MsoNormal style="MARGIN: 0in 0in 0pt">

<span style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: 'Courier New'">void</span> <span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">CTestIISDLLExtension::Default(CHttpServerContext* pCtxt, <span style="COLOR: blue">void</span>* pVoid, DWORD dwBytes)<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt">

<span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">{<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; COLOR: green; FONT-FAMILY: 'Courier New'">//&nbsp;&nbsp;&nbsp; StartContent(pCtxt);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; COLOR: green; FONT-FAMILY: 'Courier New'">//&nbsp;&nbsp;&nbsp; WriteTitle(pCtxt);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *pCtxt << _T(<span style="COLOR: #a31515">&#8220;Test&#8221;</span>);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; COLOR: green; FONT-FAMILY: 'Courier New'">//&nbsp;&nbsp;&nbsp; EndContent(pCtxt);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">}<o:p></o:p></span></p> 

This is because of a bug in MFC 8.0 ISAPI classes.&nbsp; It is unlikely that this bug will be fixed because these classes are being phased out (note there is no ISAPI wizard in VS 2005) and the workaround is relatively simple.&nbsp; The easiest fix for this problem is to ensure you add a header as the following example shows:<p class=MsoNormal style="MARGIN: 0in 0in 0pt">

<span style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: 'Courier New'">void</span> <span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">CTestIISDLLExtension::Default(CHttpServerContext* pCtxt, <span style="COLOR: blue">void</span>* pVoid, DWORD dwBytes)<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">{<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; COLOR: green; FONT-FAMILY: 'Courier New'">//&nbsp;&nbsp;&nbsp; StartContent(pCtxt);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; COLOR: green; FONT-FAMILY: 'Courier New'">//&nbsp;&nbsp;&nbsp; WriteTitle(pCtxt);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">this</span>->AddHeader(pCtxt,<span style="COLOR: #a31515">&#8220;Dummy: My Header&#8221;</span>);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *pCtxt << _T(<span style="COLOR: #a31515">&#8220;Test&#8221;</span>);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'"><o:p>&nbsp;</o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; COLOR: green; FONT-FAMILY: 'Courier New'">//&nbsp;&nbsp;&nbsp; EndContent(pCtxt);<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">}<o:p></o:p></span></p> 

Of course you can make this look more official in your case. “Company XYX: CustomISAPI”.

A little more complicated fix is for you to leverage the fact that this is a C++ class.&nbsp; The bug is in this function in the base class.&nbsp; You can&nbsp;implement this virtual&nbsp;function however and fix the issue.&nbsp; Here is the funtion signiture to override in your ISAPI Extension .h file:

&nbsp;<span style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: 'Courier New'; mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">virtual</span> <span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'; mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">DWORD HttpExtensionProc(EXTENSION_CONTROL_BLOCK *pECB);</span>

Then implement the fix by copying the source for this function from the base class (all of the source for these MFC Classes gets installed by default) and change the behavior on by adding a couple of lines.&nbsp; It is a little more complicated however because the base class has a static member you need to add to your file and you must declare some helper functions as well.&nbsp; The change is (in the original source) on line 676 of isapi.cpp.&nbsp; <p class=MsoNormal style="MARGIN: 0in 0in 0pt">

<span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: green">// The bug can be fixed by adding the following line:<o:p></o:p></span></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: green">// isapi.cpp Ln676<o:p></o:p></span></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">if</span>(ctxtCall.m_dwEndOfHeaders == 0 )<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp; <span style="COLOR: green">// Fix is to only add 1 delim, and not 2<o:p></o:p></span></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nDelimsToAdd = 1;<o:p></o:p></span></p> <p class=MsoNormal style="MARGIN: 0in 0in 0pt"><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <span style="COLOR: blue">else</span> <span style="COLOR: green">// End of Fix<o:p></o:p></span></span></p> 

Here are the globals and helper functions needed by the copied code:

<font color=#008000 size=2>

//Needed as part of the fix  
// pointers to single global server and filter objects

</font><font color=#0000ff size=2>

static</font><font size=2> CHttpServer* pServer = NULL;  
</font><font color=#0000ff size=2>static</font><font size=2> </font><font color=#0000ff size=2>const</font><font size=2> TCHAR szGet[] = _T(</font><font color=#a31515 size=2>&#8220;GET&#8221;</font><font size=2>);  
</font><font color=#0000ff size=2>static</font><font size=2> </font><font color=#0000ff size=2>const</font><font size=2> TCHAR szPost[] = _T(</font><font color=#a31515 size=2>&#8220;POST&#8221;</font><font size=2>);<p mce_keep="true">&nbsp;</p> 

</font><font color=#008000 size=2>

/////////////////////////////////////////////////////////////////////////////  
// helpers copied from afxwin.h since isapi.cpp is a separate static lib

</font><font color=#0000ff size=2>

inline</font><font size=2> </font><font color=#0000ff size=2>int</font><font size=2> AfxInvariantStrICmp(</font><font color=#0000ff size=2>const</font><font size=2> </font><font color=#0000ff size=2>char</font><font size=2> *pszLeft, </font><font color=#0000ff size=2>const</font><font size=2> </font><font color=#0000ff size=2>char</font><font size=2> *pszRight)  
{  
</font><font color=#0000ff size=2>&nbsp;&nbsp;&nbsp; return</font><font size=2> ::CompareStringA(MAKELCID(MAKELANGID(LANG\_ENGLISH,SUBLANG\_ENGLISH\_US),SORT\_DEFAULT),  
NORM\_IGNORECASE,pszLeft,-1,pszRight,-1)-CSTR\_EQUAL;  
}

</font><font color=#0000ff size=2>

inline</font><font size=2> </font><font color=#0000ff size=2>int</font><font size=2> AfxInvariantStrICmp(</font><font color=#0000ff size=2>const</font><font size=2> </font><font color=#0000ff size=2>wchar_t</font><font size=2> *pwszLeft, </font><font color=#0000ff size=2>const</font><font size=2> </font><font color=#0000ff size=2>wchar_t</font><font size=2> *pwszRight)  
{  
</font><font color=#0000ff size=2>&nbsp;&nbsp;&nbsp; return</font><font size=2> ::CompareStringW(MAKELCID(MAKELANGID(LANG\_ENGLISH,SUBLANG\_ENGLISH\_US),SORT\_DEFAULT),NORM\_IGNORECASE,pwszLeft,-1,pwszRight,-1)-CSTR\_EQUAL;  
</font><font size=2>}  
</font><font color=#008000 size=2>//&nbsp; End Additions</font>

Finally you need to initialize pServer in the constuctor:

<font size=2>

CTestIISDLLExtension::CTestIISDLLExtension()  
{  
&nbsp;&nbsp;&nbsp; </font><font color=#008000 size=2>pServer = this;  
</font><font size=2>}

</font><font size=2>I leave it to you to iron out all the nitty gritty details and as with any sample code is you up to you to understand and test your changes.</font>